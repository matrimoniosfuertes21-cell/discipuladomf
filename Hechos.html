<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respondiendo - Hechos de los Ap√≥stoles</title>
    <!-- Tailwind CSS para dise√±o r√°pido y bonito -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fuente Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #e0f7fa 0%, #bbdefb 100%);
            overflow-x: hidden;
        }
        h1, h2, h3, .title-font {
            font-family: 'Fredoka', sans-serif;
        }
        
        /* Animaciones Personalizadas */
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            80% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .animate-pop { animation: popIn 0.5s ease-out forwards; }
        .animate-slide { animation: slideUp 0.5s ease-out forwards; }
        .animate-shake { animation: shake 0.4s ease-in-out; }
        .animate-float { animation: float 3s ease-in-out infinite; }

        .btn-option {
            transition: all 0.2s;
            cursor: pointer;
        }
        .btn-option:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn-option:active:not(:disabled) {
            transform: translateY(0);
        }

        /* Barra de tiempo */
        .timer-container {
            width: 100%;
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 999px;
            overflow: hidden;
            margin-top: 1rem;
            display: none; /* Oculto inicialmente */
        }
        
        .timer-bar {
            height: 100%;
            background-color: #f59e0b; /* Ambar */
            width: 100%;
            transition: width 0.1s linear, background-color 0.3s;
        }

        .correct-answer { background-color: #4ade80 !important; color: #064e3b !important; border-color: #22c55e !important; }
        .wrong-answer { background-color: #f87171 !important; color: #7f1d1d !important; border-color: #ef4444 !important; }
        
        /* Ocultar secciones por defecto - A√ëADIDO !important PARA CORREGIR EL ERROR VISUAL */
        .hidden-section { display: none !important; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center text-slate-800 selection:bg-yellow-200">

    <!-- CONTENEDOR PRINCIPAL -->
    <div id="app" class="w-full max-w-2xl bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl overflow-hidden min-h-[600px] relative border border-white/50 m-4">
        
        <!-- PANTALLA DE INICIO -->
        <div id="start-screen" class="p-8 flex flex-col items-center justify-center h-full text-center animate-pop">
            <div class="mb-6 text-6xl animate-float">üïäÔ∏è</div>
            <h1 class="text-4xl md:text-5xl font-bold text-blue-600 mb-2">Hechos de los Ap√≥stoles</h1>
            <p class="text-lg text-slate-500 mb-8">Desaf√≠o B√≠blico Interactivo</p>
            
            <div class="w-full max-w-sm space-y-4">
                <div class="relative">
                    <input type="text" id="player-name" placeholder="Ingresa tu nombre..." 
                        class="w-full px-6 py-4 rounded-xl border-2 border-blue-100 focus:border-blue-500 focus:outline-none text-lg bg-white/50 transition-colors text-center font-bold text-blue-900 placeholder-blue-300">
                </div>
                <button onclick="startGame()" 
                    class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg hover:shadow-blue-500/30 transform hover:-translate-y-1 transition-all text-xl">
                    ¬°Comenzar Aventura!
                </button>
            </div>
        </div>

        <!-- PANTALLA DE TRANSICI√ìN DE CAP√çTULO -->
        <div id="transition-screen" class="hidden-section absolute inset-0 bg-gradient-to-br from-indigo-600 to-blue-500 z-50 flex flex-col items-center justify-center text-white p-8 text-center">
            <h2 class="text-2xl font-light opacity-90 mb-2">Nivel <span id="trans-level-num">1</span></h2>
            <h1 id="trans-chapter-title" class="text-4xl md:text-5xl font-bold mb-6 leading-tight animate-pop">T√≠tulo del Cap√≠tulo</h1>
            <div class="w-16 h-16 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
            <p class="mt-4 text-white/80">Preparando preguntas...</p>
        </div>

        <!-- PANTALLA DE JUEGO -->
        <div id="game-screen" class="hidden-section p-6 h-full flex flex-col">
            <!-- HUD -->
            <div class="flex justify-between items-center mb-6 bg-blue-50 p-4 rounded-2xl border border-blue-100">
                <div class="flex items-center space-x-2">
                    <span class="text-2xl">‚ù§Ô∏è</span>
                    <span id="lives-display" class="font-bold text-xl text-red-500">3</span>
                </div>
                <div class="flex flex-col items-center">
                    <span class="text-xs uppercase tracking-wider text-slate-400 font-bold">Cap√≠tulo</span>
                    <span id="chapter-display" class="font-bold text-blue-600 text-lg">1</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-2xl">‚≠ê</span>
                    <span id="score-display" class="font-bold text-xl text-yellow-600">0</span>
                </div>
            </div>

            <!-- Area de Pregunta -->
            <div class="flex-grow flex flex-col justify-center">
                <div class="mb-8">
                    <span class="inline-block px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-bold mb-3 tracking-wide">PREGUNTA <span id="q-num">1</span></span>
                    <h2 id="question-text" class="text-2xl md:text-3xl font-bold text-slate-800 leading-snug animate-slide">
                        ¬øPregunta cargando?
                    </h2>
                </div>

                <!-- Opciones -->
                <div id="options-container" class="space-y-3">
                    <!-- Los botones se generan con JS -->
                </div>

                <!-- Temporizador -->
                <div id="timer-wrapper" class="timer-container mt-6 opacity-0 transition-opacity duration-300">
                    <div id="timer-bar" class="timer-bar"></div>
                </div>
                <p id="timer-text" class="text-center text-sm text-slate-400 mt-2 h-5"></p>
            </div>
        </div>

        <!-- PANTALLA FINAL (GAME OVER / WIN) -->
        <div id="end-screen" class="hidden-section p-8 flex flex-col items-center justify-center h-full text-center relative overflow-hidden">
            <!-- Confeti decorativo (simulado con CSS/emojis) -->
            <div class="absolute top-0 left-0 w-full h-full pointer-events-none opacity-10 text-9xl flex flex-wrap justify-center overflow-hidden">
                ‚ú® üéâ üèÜ üéâ ‚ú®
            </div>

            <div id="end-icon" class="text-8xl mb-6 animate-pop">üèÜ</div>
            
            <h1 id="end-title" class="text-4xl font-bold text-slate-800 mb-2">¬°Felicidades!</h1>
            <p id="end-message" class="text-xl text-slate-600 mb-8">Has completado el juego</p>

            <div class="bg-white p-6 rounded-2xl shadow-xl border border-slate-100 w-full max-w-sm mb-8 transform rotate-1">
                <h3 class="text-lg text-slate-400 font-semibold uppercase tracking-wider mb-2">Tarjeta de Jugador</h3>
                <div class="border-b-2 border-slate-100 mb-4"></div>
                <h2 id="end-player-name" class="text-3xl font-bold text-blue-600 mb-1">Nombre</h2>
                <div class="grid grid-cols-2 gap-4 mt-4">
                    <div class="bg-blue-50 p-3 rounded-lg">
                        <span class="block text-xs text-blue-400 font-bold">PUNTOS</span>
                        <span id="end-score" class="text-2xl font-bold text-blue-700">0</span>
                    </div>
                    <div class="bg-yellow-50 p-3 rounded-lg">
                        <span class="block text-xs text-yellow-500 font-bold">NIVEL</span>
                        <span id="end-level" class="text-2xl font-bold text-yellow-700">1</span>
                    </div>
                </div>
            </div>

            <button onclick="resetGame()" 
                class="bg-slate-800 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-slate-700 transform hover:scale-105 transition-all">
                üîÑ Jugar de nuevo
            </button>
        </div>

    </div>

    <!-- L√ìGICA DEL JUEGO -->
    <script>
        // ==========================================
        // CONFIGURACI√ìN
        // ==========================================
        
        // ¬°CAMBIA ESTE N√öMERO PARA DEFINIR CU√ÅNTAS PREGUNTAS POR NIVEL!
        const QUESTIONS_PER_LEVEL_CONFIG = 3; 
        
        const TIME_LIMIT = 10; // Segundos para responder
        const MAX_LIVES = 3;

        // ==========================================
        // BANCO DE PREGUNTAS (HECHOS DE LOS AP√ìSTOLES)
        // ==========================================
        // Nota: He puesto 5 preguntas para los primeros cap√≠tulos y una estructura
        // para los 28. Puedes a√±adir m√°s copiando el formato.
        
        const actsData = [
            {
                chapter: 1,
                title: "La Promesa del Esp√≠ritu",
                questions: [
                    { q: "¬øA qui√©n dirigi√≥ Lucas su primer tratado (el Evangelio) y este libro?", options: ["A Te√≥filo", "A Pedro", "A Pablo"], correct: 0 },
                    { q: "¬øCu√°ntos d√≠as se apareci√≥ Jes√∫s a los ap√≥stoles despu√©s de su pasi√≥n?", options: ["3 d√≠as", "40 d√≠as", "50 d√≠as"], correct: 1 },
                    { q: "¬øQu√© promesa les dio Jes√∫s antes de ascender?", options: ["Ser√≠an ricos", "Ser√≠an bautizados con el Esp√≠ritu Santo", "Gobernar√≠an Roma"], correct: 1 },
                    { q: "¬øQui√©n fue elegido para reemplazar a Judas?", options: ["Jos√© llamado Barsab√°s", "Mat√≠as", "Bernab√©"], correct: 1 },
                    { q: "¬øDesde qu√© monte ascendi√≥ Jes√∫s al cielo?", options: ["Monte Sina√≠", "Monte de los Olivos", "Monte Tabor"], correct: 1 },
					// Preguntas adicionales para el Cap√≠tulo 1: La Promesa del Esp√≠ritu
					{ q: "¬øQu√© les mand√≥ Jes√∫s que hicieran en Jerusal√©n mientras esperaban?", options: ["Que predicaran en el templo", "Que esperaran la promesa del Padre", "Que se escondieran de los romanos"], correct: 1 },
					{ q: "Seg√∫n el texto, ¬øcon qu√© bautiz√≥ Juan?", options: ["Con fuego", "Con agua", "Con aceite"], correct: 1 },
					{ q: "¬øQu√© preguntaron los disc√≠pulos a Jes√∫s antes de su ascensi√≥n?", options: ["¬øCu√°ndo volver√°s?", "¬øRestaurar√°s el reino a Israel en este tiempo?", "¬øQui√©n nos liderar√°?"], correct: 1 },
					{ q: "¬øQu√© dijo Jes√∫s que recibir√≠an cuando viniera sobre ellos el Esp√≠ritu Santo?", options: ["Poder", "Riquezas", "Autoridad pol√≠tica"], correct: 0 },
					{ q: "¬øHasta d√≥nde les dijo Jes√∫s que ser√≠an testigos?", options: ["Solo en Judea", "En Jerusal√©n y Samaria", "Hasta lo √∫ltimo de la tierra"], correct: 2 },
					{ q: "¬øQu√© ocult√≥ a Jes√∫s de la vista de los disc√≠pulos mientras ascend√≠a?", options: ["Una luz brillante", "Una nube", "Un carro de fuego"], correct: 1 },
					{ q: "¬øQui√©nes se pusieron junto a los disc√≠pulos mientras miraban al cielo?", options: ["Mois√©s y El√≠as", "Dos varones con vestiduras blancas", "Un √°ngel con espada"], correct: 1 },
					{ q: "¬øQu√© distancia se menciona que hay desde el Monte de los Olivos a Jerusal√©n?", options: ["Camino de un d√≠a de reposo", "Dos millas", "Tres d√≠as de camino"], correct: 0 },
					{ q: "¬øEn qu√© lugar de Jerusal√©n se alojaban y reun√≠an los disc√≠pulos?", options: ["En el atrio del templo", "En un aposento alto", "En la casa de Caif√°s"], correct: 1 },
					{ q: "¬øQui√©nes perseveraban en oraci√≥n junto con los ap√≥stoles?", options: ["Solo los varones", "Las mujeres, Mar√≠a la madre de Jes√∫s, y sus hermanos", "Los sacerdotes del templo"], correct: 1 },
					{ q: "¬øAproximadamente cu√°ntas personas estaban reunidas cuando Pedro se levant√≥ a hablar?", options: ["Doce", "Setenta", "Ciento veinte"], correct: 2 },
					{ q: "¬øC√≥mo se llam√≥ el campo comprado con el salario de la iniquidad de Judas?", options: ["G√≥lgota", "Ac√©ldama", "Getseman√≠"], correct: 1 },
					{ q: "¬øQu√© significa el nombre 'Ac√©ldama'?", options: ["Campo de Paz", "Campo de Sangre", "Campo de Alfarero"], correct: 1 },
					{ q: "¬øQu√© requisito deb√≠a cumplir el candidato para reemplazar a Judas?", options: ["Ser de la tribu de Lev√≠", "Haber estado con ellos desde el bautismo de Juan hasta la ascensi√≥n", "Ser sabio en las Escrituras"], correct: 1 },
					{ q: "¬øQu√© hicieron los ap√≥stoles para decidir entre Jos√© y Mat√≠as?", options: ["Votaron a mano alzada", "Eligeron al mayor", "Oraron y echaron suertes"], correct: 2 }
                ]
            },
            {
                chapter: 2,
                title: "La Venida del Esp√≠ritu Santo",
                questions: [
                    { q: "¬øQu√© sonido se escuch√≥ el d√≠a de Pentecost√©s?", options: ["Un trueno fuerte", "Una r√°faga de viento recio", "M√∫sica celestial"], correct: 1 },
                    { q: "¬øQu√© se les apareci√≥ sobre sus cabezas?", options: ["Palomas blancas", "Lenguas como de fuego", "Halos de luz"], correct: 1 },
                    { q: "¬øQu√© dec√≠an algunos burl√°ndose de los ap√≥stoles?", options: ["Est√°n locos", "Est√°n llenos de mosto (ebrios)", "Son magos"], correct: 1 },
                    { q: "¬øCu√°ntas personas se convirtieron tras el discurso de Pedro?", options: ["Como tres mil", "Quinientas", "Doce"], correct: 0 },
                    { q: "¬øQu√© profeta cit√≥ Pedro en su discurso?", options: ["Isa√≠as", "Joel", "Jerem√≠as"], correct: 1 }
                ]
            },
            {
                chapter: 3,
                title: "El Cojo de la Hermosa",
                questions: [
                    { q: "¬øQui√©nes sub√≠an al templo a la hora de la oraci√≥n?", options: ["Pedro y Juan", "Pablo y Bernab√©", "Santiago y Juan"], correct: 0 },
                    { q: "¬øQu√© ped√≠a el hombre cojo en la puerta del templo?", options: ["Sanidad", "Comida", "Limosna"], correct: 2 },
                    { q: "¬øQu√© le dijo Pedro al cojo?", options: ["No tengo plata ni oro", "Ten fe y anda", "Ven ma√±ana"], correct: 0 },
                    { q: "¬øC√≥mo se llamaba la puerta del templo?", options: ["La Dorada", "La Hermosa", "La Oriental"], correct: 1 },
                    { q: "¬øA qu√© hora era la oraci√≥n?", options: ["La hora novena", "La hora tercera", "Al mediod√≠a"], correct: 0 }
                ]
            },
            {
                chapter: 4,
                title: "Pedro y Juan ante el Concilio",
                questions: [
                    { q: "¬øQui√©nes se resent√≠an porque ense√±aban la resurrecci√≥n?", options: ["Los Fariseos", "Los Saduceos", "Los Romanos"], correct: 1 },
                    { q: "¬øA cu√°ntos lleg√≥ el n√∫mero de varones que creyeron?", options: ["Aproximadamente cinco mil", "Dos mil", "Diez mil"], correct: 0 },
                    { q: "¬øQu√© notaron los gobernantes sobre Pedro y Juan?", options: ["Que eran hombres sin letras y del vulgo", "Que eran muy ricos", "Que eran romanos"], correct: 0 },
                    { q: "¬øQu√© nombre es el √∫nico dado a los hombres para salvaci√≥n?", options: ["Mois√©s", "Jes√∫s", "Abraham"], correct: 1 },
                    { q: "¬øQu√© pas√≥ cuando oraron despu√©s de ser liberados?", options: ["Llovi√≥ fuego", "El lugar tembl√≥", "Todos callaron"], correct: 1 }
                ]
            },
            {
                chapter: 5,
                title: "Anan√≠as y Safira",
                questions: [
                    { q: "¬øQu√© hicieron Anan√≠as y Safira?", options: ["Blasfemaron", "Sustrajeron del precio de la heredad", "Negaron a Jes√∫s"], correct: 1 },
                    { q: "¬øQu√© le pas√≥ a Anan√≠as al o√≠r las palabras de Pedro?", options: ["Se arrepinti√≥", "Cay√≥ y expir√≥", "Huy√≥ corriendo"], correct: 1 },
                    { q: "¬øQui√©n liber√≥ a los ap√≥stoles de la c√°rcel p√∫blica?", options: ["Un √°ngel del Se√±or", "El carcelero", "Gamaliel"], correct: 0 },
                    { q: "¬øQu√© consejo dio Gamaliel?", options: ["Matarlos a todos", "Dejarlos, por si es obra de Dios", "Encarcelarlos de por vida"], correct: 1 },
                    { q: "¬øQu√© sombra sanaba a los enfermos?", options: ["La de Pedro", "La de Juan", "La de Pablo"], correct: 0 }
                ]
            },
            // CAP√çTULOS 6 al 28 (Generados con estructura para completar)
            // Para el prop√≥sito del demo, usar√© preguntas gen√©ricas de Hechos o placeholders editables
            {
                chapter: 6,
                title: "Elecci√≥n de los Di√°conos",
                questions: [
                    { q: "¬øCu√°ntos varones de buen testimonio escogieron?", options: ["Siete", "Doce", "Tres"], correct: 0 },
                    { q: "¬øDe qu√© grupo eran las viudas desatendidas?", options: ["Hebreos", "Griegos", "Romanos"], correct: 1 },
                    { q: "¬øQui√©n estaba lleno de gracia y poder?", options: ["Esteban", "Felipe", "Pr√≥coro"], correct: 0 },
                    { q: "¬øQu√© acusaci√≥n falsa lanzaron contra Esteban?", options: ["Robar", "Blasfemar contra Mois√©s y Dios", "No pagar impuestos"], correct: 1 },
                    { q: "¬øQu√© vieron en el rostro de Esteban?", options: ["Ira", "Miedo", "Rostro de √°ngel"], correct: 2 }
                ]
            },
            {
                chapter: 7,
                title: "Discurso y Muerte de Esteban",
                questions: [
                    { q: "¬øA qui√©n vio Esteban a la diestra de Dios?", options: ["A El√≠as", "Al Hijo del Hombre", "A Mois√©s"], correct: 1 },
                    { q: "¬øC√≥mo mataron a Esteban?", options: ["Crucificado", "Decapitado", "Apedreado"], correct: 2 },
                    { q: "¬øA los pies de qu√© joven pusieron sus ropas?", options: ["Saulo", "Pedro", "Timoteo"], correct: 0 },
                    { q: "¬øQu√© dijo Esteban al morir?", options: ["V√©ngame Se√±or", "Se√±or, no les tomes en cuenta este pecado", "Tengo sed"], correct: 1 },
                    { q: "¬øQu√© patriarca sali√≥ de su tierra sin saber a d√≥nde iba?", options: ["Abraham", "Isaac", "Jacob"], correct: 0 }
                ]
            },
            {
                chapter: 8,
                title: "Saulo persigue a la iglesia",
                questions: [
                    { q: "¬øA d√≥nde fue Felipe a predicar?", options: ["Samaria", "Damasco", "Roma"], correct: 0 },
                    { q: "¬øQu√© hombre practicaba magia en Samaria?", options: ["Sim√≥n", "Elimas", "Alejandro"], correct: 0 },
                    { q: "¬øQu√© quer√≠a comprar Sim√≥n con dinero?", options: ["El perd√≥n", "El don del Esp√≠ritu Santo", "Un puesto de ap√≥stol"], correct: 1 },
                    { q: "¬øA qui√©n evangeliz√≥ Felipe en el camino a Gaza?", options: ["Un centuri√≥n", "Un eunuco et√≠ope", "Un fariseo"], correct: 1 },
                    { q: "¬øQu√© le√≠a el eunuco?", options: ["Salmos", "Isa√≠as", "La Ley"], correct: 1 }
                ]
            },
            {
                chapter: 9,
                title: "Conversi√≥n de Saulo",
                questions: [
                    { q: "¬øHacia qu√© ciudad iba Saulo persiguiendo cristianos?", options: ["Jerusal√©n", "Antioqu√≠a", "Damasco"], correct: 2 },
                    { q: "¬øQu√© le pas√≥ a Saulo en el camino?", options: ["Se cay√≥ del caballo", "Le rode√≥ una luz del cielo", "Se encontr√≥ con Pedro"], correct: 1 },
                    { q: "¬øCu√°ntos d√≠as estuvo Saulo sin ver?", options: ["Tres d√≠as", "Siete d√≠as", "Un d√≠a"], correct: 0 },
                    { q: "¬øQui√©n or√≥ por Saulo para que recobrara la vista?", options: ["Bernab√©", "Anan√≠as", "Silas"], correct: 1 },
                    { q: "¬øA qui√©n resucit√≥ Pedro en Jope?", options: ["Eneas", "Tabita (Dorcas)", "Lidia"], correct: 1 }
                ]
            },
            {
                chapter: 10,
                title: "Pedro y Cornelio",
                questions: [
                    { q: "¬øDe qu√© compa√±√≠a era centuri√≥n Cornelio?", options: ["La Augusta", "La Italiana", "La Pretoriana"], correct: 1 },
                    { q: "¬øQu√© vio Pedro en su visi√≥n?", options: ["√Ångeles cantando", "Un lienzo con animales", "Fuego del cielo"], correct: 1 },
                    { q: "¬øQu√© entendi√≥ Pedro con la visi√≥n?", options: ["Que no debe comer carne", "Que Dios no hace acepci√≥n de personas", "Que debe ir a Roma"], correct: 1 },
                    { q: "¬øQu√© pas√≥ mientras Pedro predicaba a los gentiles?", options: ["El Esp√≠ritu Santo cay√≥ sobre ellos", "Hubo un terremoto", "Cornelio se durmi√≥"], correct: 0 },
                    { q: "¬øQu√© mand√≥ Pedro despu√©s?", options: ["Que se fueran", "Que fueran bautizados", "Que pagaran diezmo"], correct: 1 }
                ]
            }
        ];

        // Generar placeholders para cap√≠tulos 11-28 para completar el array (para el demo)
        for(let i = 11; i <= 28; i++) {
            actsData.push({
                chapter: i,
                title: `Cap√≠tulo ${i}: Misiones y Viajes`,
                questions: [
                    { q: `Pregunta de prueba del cap ${i} - A`, options: ["Opci√≥n Correcta", "Incorrecta 1", "Incorrecta 2"], correct: 0 },
                    { q: `Pregunta de prueba del cap ${i} - B`, options: ["Incorrecta 1", "Opci√≥n Correcta", "Incorrecta 2"], correct: 1 },
                    { q: `Pregunta de prueba del cap ${i} - C`, options: ["Incorrecta 1", "Incorrecta 2", "Opci√≥n Correcta"], correct: 2 },
                    { q: `Pregunta de prueba del cap ${i} - D`, options: ["Opci√≥n Correcta", "Incorrecta 1", "Incorrecta 2"], correct: 0 },
                    { q: `Pregunta de prueba del cap ${i} - E`, options: ["Incorrecta 1", "Opci√≥n Correcta", "Incorrecta 2"], correct: 1 }
                ]
            });
        }

        // ==========================================
        // ESTADO DEL JUEGO
        // ==========================================
        let gameState = {
            playerName: "",
            score: 0,
            lives: MAX_LIVES,
            currentChapterIndex: 0,
            chapterQuestions: [], // Preguntas seleccionadas para el nivel actual
            currentQuestionIndex: 0,
            timerInterval: null,
            canAnswer: false
        };

        // Elementos DOM
        const screens = {
            start: document.getElementById('start-screen'),
            transition: document.getElementById('transition-screen'),
            game: document.getElementById('game-screen'),
            end: document.getElementById('end-screen')
        };

        const ui = {
            playerNameInput: document.getElementById('player-name'),
            lives: document.getElementById('lives-display'),
            score: document.getElementById('score-display'),
            chapter: document.getElementById('chapter-display'),
            transLevel: document.getElementById('trans-level-num'),
            transTitle: document.getElementById('trans-chapter-title'),
            qNum: document.getElementById('q-num'),
            qText: document.getElementById('question-text'),
            options: document.getElementById('options-container'),
            timerBar: document.getElementById('timer-bar'),
            timerWrapper: document.getElementById('timer-wrapper'),
            timerText: document.getElementById('timer-text'),
            endTitle: document.getElementById('end-title'),
            endMsg: document.getElementById('end-message'),
            endName: document.getElementById('end-player-name'),
            endScore: document.getElementById('end-score'),
            endLevel: document.getElementById('end-level'),
            endIcon: document.getElementById('end-icon'),
            app: document.getElementById('app')
        };

        // ==========================================
        // L√ìGICA
        // ==========================================

        function showScreen(screenName) {
            Object.values(screens).forEach(s => s.classList.add('hidden-section'));
            screens[screenName].classList.remove('hidden-section');
        }

        function startGame() {
            const name = ui.playerNameInput.value.trim();
            if (!name) {
                ui.playerNameInput.classList.add('animate-shake');
                ui.playerNameInput.classList.add('border-red-400');
                setTimeout(() => {
                    ui.playerNameInput.classList.remove('animate-shake');
                    ui.playerNameInput.classList.remove('border-red-400');
                }, 500);
                return;
            }

            gameState.playerName = name;
            gameState.score = 0;
            gameState.lives = MAX_LIVES;
            gameState.currentChapterIndex = 0;
            
            updateHUD();
            startChapterTransition();
        }

        function startChapterTransition() {
            const currentData = actsData[gameState.currentChapterIndex];
            
            // Preparar UI Transici√≥n
            ui.transLevel.innerText = currentData.chapter;
            ui.transTitle.innerText = currentData.title;
            
            showScreen('transition');

            // Seleccionar preguntas aleatorias para este nivel
            const allQuestions = [...currentData.questions];
            // Algoritmo de mezcla (Fisher-Yates)
            for (let i = allQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allQuestions[i], allQuestions[j]] = [allQuestions[j], allQuestions[i]];
            }
            
            // Tomar solo las necesarias
            gameState.chapterQuestions = allQuestions.slice(0, QUESTIONS_PER_LEVEL_CONFIG);
            gameState.currentQuestionIndex = 0;

            // Esperar y mostrar juego
            setTimeout(() => {
                showScreen('game');
                loadQuestion();
            }, 3000); // 3 segundos de transici√≥n
        }

        function loadQuestion() {
            clearInterval(gameState.timerInterval);
            ui.timerWrapper.style.opacity = "0";
            ui.timerWrapper.style.display = "none";
            ui.timerBar.style.width = "100%";
            ui.timerBar.classList.remove('bg-red-500');
            ui.timerBar.classList.add('bg-yellow-500');
            ui.timerText.innerText = "";
            gameState.canAnswer = false;

            const qData = gameState.chapterQuestions[gameState.currentQuestionIndex];
            
            // UI Update
            ui.qNum.innerText = gameState.currentQuestionIndex + 1;
            ui.qText.innerText = qData.q;
            ui.qText.classList.remove('animate-slide');
            void ui.qText.offsetWidth; // Trigger reflow
            ui.qText.classList.add('animate-slide');

            // Generar Opciones
            ui.options.innerHTML = '';
            
            // Mostrar opciones una por una
            qData.options.forEach((opt, index) => {
                const btn = document.createElement('div');
                btn.className = 'btn-option bg-white border-2 border-blue-100 p-4 rounded-xl text-lg font-medium text-slate-700 shadow-sm opacity-0 transform translate-y-4';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(index, btn);
                ui.options.appendChild(btn);

                // Animaci√≥n secuencial
                setTimeout(() => {
                    btn.style.transition = "all 0.3s ease-out";
                    btn.style.opacity = "1";
                    btn.style.transform = "translateY(0)";
                    
                    // Si es la √∫ltima opci√≥n, iniciar timer
                    if (index === qData.options.length - 1) {
                        setTimeout(startTimer, 500);
                    }
                }, index * 600); // 600ms entre cada opci√≥n
            });
        }

        function startTimer() {
            gameState.canAnswer = true;
            ui.timerWrapper.style.display = "block";
            // Peque√±o delay para que el fade in funcione
            setTimeout(() => ui.timerWrapper.style.opacity = "1", 50);

            let timeLeft = TIME_LIMIT;
            ui.timerText.innerText = `${timeLeft}s`;

            // Animaci√≥n CSS pura para la barra
            ui.timerBar.style.transition = `width ${TIME_LIMIT}s linear`;
            ui.timerBar.style.width = "0%";

            gameState.timerInterval = setInterval(() => {
                timeLeft--;
                ui.timerText.innerText = timeLeft > 0 ? `${timeLeft}s` : "¬°Tiempo!";
                
                if (timeLeft <= 3) {
                    ui.timerBar.classList.remove('bg-yellow-500');
                    ui.timerBar.classList.add('bg-red-500');
                }

                if (timeLeft <= 0) {
                    clearInterval(gameState.timerInterval);
                    handleTimeOut();
                }
            }, 1000);
        }

        function checkAnswer(selectedIndex, btnElement) {
            if (!gameState.canAnswer) return;
            gameState.canAnswer = false;
            clearInterval(gameState.timerInterval);
            
            // Detener animaci√≥n de barra
            const currentWidth = ui.timerBar.offsetWidth;
            ui.timerBar.style.transition = "none";
            ui.timerBar.style.width = `${currentWidth}px`;

            const currentQ = gameState.chapterQuestions[gameState.currentQuestionIndex];
            const isCorrect = selectedIndex === currentQ.correct;
            const correctBtnIndex = currentQ.correct;

            // Visual Feedback
            if (isCorrect) {
                btnElement.classList.add('correct-answer');
                gameState.score++;
                ui.score.classList.add('animate-pop');
                setTimeout(() => ui.score.classList.remove('animate-pop'), 500);
            } else {
                btnElement.classList.add('wrong-answer');
                // Mostrar cual era la correcta
                ui.options.children[correctBtnIndex].classList.add('correct-answer');
                gameState.lives--;
                ui.app.classList.add('animate-shake'); // Sacudir toda la app
                setTimeout(() => ui.app.classList.remove('animate-shake'), 500);
            }

            updateHUD();

            // Esperar y siguiente paso
            setTimeout(() => {
                if (gameState.lives <= 0) {
                    endGame(false);
                } else {
                    nextQuestion();
                }
            }, 2000);
        }

        function handleTimeOut() {
            gameState.canAnswer = false;
            gameState.lives--;
            updateHUD();
            
            // Mostrar respuesta correcta
            const currentQ = gameState.chapterQuestions[gameState.currentQuestionIndex];
            ui.options.children[currentQ.correct].classList.add('correct-answer');
            ui.options.children[currentQ.correct].classList.add('animate-pop');

            setTimeout(() => {
                if (gameState.lives <= 0) {
                    endGame(false);
                } else {
                    nextQuestion();
                }
            }, 2000);
        }

        function nextQuestion() {
            gameState.currentQuestionIndex++;

            if (gameState.currentQuestionIndex >= gameState.chapterQuestions.length) {
                // Fin del capitulo
                gameState.currentChapterIndex++;
                if (gameState.currentChapterIndex >= actsData.length) {
                    endGame(true); // Gan√≥ todo
                } else {
                    startChapterTransition();
                }
            } else {
                loadQuestion();
            }
        }

        function updateHUD() {
            ui.lives.innerText = gameState.lives;
            ui.score.innerText = gameState.score;
            ui.chapter.innerText = gameState.currentChapterIndex + 1;
        }

        function endGame(victory) {
            showScreen('end');
            ui.endName.innerText = gameState.playerName;
            ui.endScore.innerText = gameState.score;
            ui.endLevel.innerText = gameState.currentChapterIndex + (victory ? 0 : 1);

            if (victory) {
                ui.endTitle.innerText = "¬°ASOMBROSO!";
                ui.endTitle.className = "text-4xl font-bold text-yellow-600 mb-2";
                ui.endMessage.innerText = "¬°Has completado todo el libro de Hechos!";
                ui.endIcon.innerText = "üëë";
            } else {
                // Mensaje animoso por derrota
                ui.endTitle.innerText = "¬°Buen Intento!";
                ui.endTitle.className = "text-4xl font-bold text-blue-600 mb-2";
                ui.endIcon.innerText = "üõ°Ô∏è";
                
                const msgs = [
                    "¬°No te rindas! La Palabra es vida.",
                    "¬°Casi lo logras! Vuelve a intentarlo.",
                    "Sigue estudiando y llegar√°s lejos.",
                    "¬°Has llegado muy lejos, felicidades!"
                ];
                ui.endMsg.innerText = msgs[Math.floor(Math.random() * msgs.length)];
            }
        }

        function resetGame() {
            showScreen('start');
            ui.playerNameInput.value = '';
        }

    </script>
</body>
</html>